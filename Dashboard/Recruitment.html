<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recruitment</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
            padding: 30px;
        }
        
        .container { max-width: 1400px; margin: 0 auto; }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 28px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        .btn:hover { background: #764ba2; }
        
        .tabs {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
        }
        
        .tab-btn {
            background: none;
            border: none;
            padding: 15px 0;
            font-size: 16px;
            cursor: pointer;
            color: #999;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-open {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-closed {
            background: #f8d7da;
            color: #721c24;
        }
        
        .badge-new {
            background: #cfe2ff;
            color: #084298;
        }
        
        .badge-interview {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-hired {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-rejected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            background: #e9ecef;
            color: #333;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn-small:hover {
            background: #667eea;
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Poppins', sans-serif;
        }
        
        .form-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ’¼ Recruitment Management</h1>
            <button class="btn" onclick="toggleJobForm()">+ Post New Job</button>
        </div>

        <!-- Add Job Form -->
        <div id="jobForm" class="form-container" style="display: none;">
            <h3>Post New Job</h3>
            <div class="form-group">
                <label>Job Title</label>
                <input type="text" id="jobTitle" placeholder="e.g., Software Engineer">
            </div>
            <div class="form-group">
                <label>Department</label>
                <input type="text" id="department" placeholder="e.g., IT">
            </div>
            <div class="form-group">
                <label>Experience</label>
                <input type="text" id="experience" placeholder="e.g., 2-3 years">
            </div>
            <div class="form-group">
                <label>Salary Range</label>
                <input type="text" id="salaryRange" placeholder="e.g., $50K - $70K">
            </div>
            <button class="btn" onclick="submitJob()">Post Job</button>
            <button class="btn-small" onclick="toggleJobForm()" style="background: #ccc; color: #333; margin-left: 10px;">Cancel</button>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('jobs')">Job Openings</button>
            <button class="tab-btn" onclick="switchTab('candidates')">Candidates</button>
            <button class="tab-btn" onclick="switchTab('interviews')">Interviews</button>
        </div>

        <!-- Jobs Tab -->
        <div id="jobs" class="tab-content active">
            <table>
                <thead>
                    <tr>
                        <th>Job Title</th>
                        <th>Department</th>
                        <th>Experience</th>
                        <th>Salary Range</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="jobsTable">
                    <tr><td colspan="6" class="loading">Loading jobs...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Candidates Tab -->
        <div id="candidates" class="tab-content">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Position</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="candidatesTable">
                    <tr><td colspan="6" class="loading">Loading candidates...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Interviews Tab -->
        <div id="interviews" class="tab-content">
            <p class="loading">Interview management coming soon...</p>
        </div>
    </div>

    <script>
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'jobs') loadJobs();
            if (tabName === 'candidates') loadCandidates();
        }

        function toggleJobForm() {
            const form = document.getElementById('jobForm');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }

        async function loadJobs() {
            try {
                const response = await fetch('http://13.60.237.35:3048/api/jobs', {
                    credentials: 'include'
                });
                const jobs = await response.json();
                
                if (jobs.length === 0) {
                    document.getElementById('jobsTable').innerHTML = '<tr><td colspan="6" class="loading">No job openings</td></tr>';
                    return;
                }

                document.getElementById('jobsTable').innerHTML = jobs.map(job => `
                    <tr>
                        <td><strong>${job.job_title}</strong></td>
                        <td>${job.department}</td>
                        <td>${job.experience}</td>
                        <td>${job.salary_range}</td>
                        <td><span class="badge badge-${job.status}">${job.status.toUpperCase()}</span></td>
                        <td>
                            <div class="actions">
                                <button class="btn-small" onclick="editJob(${job.id})">Edit</button>
                                <button class="btn-small" onclick="closeJob(${job.id})">Close</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading jobs:', error);
                document.getElementById('jobsTable').innerHTML = '<tr><td colspan="6" class="loading">Error loading jobs</td></tr>';
            }
        }

        async function loadCandidates() {
            try {
                const response = await fetch('http://13.60.237.35:3048/api/candidates', {
                    credentials: 'include'
                });
                const candidates = await response.json();
                
                if (candidates.length === 0) {
                    document.getElementById('candidatesTable').innerHTML = '<tr><td colspan="6" class="loading">No candidates</td></tr>';
                    return;
                }

                document.getElementById('candidatesTable').innerHTML = candidates.map(candidate => `
                    <tr>
                        <td><strong>${candidate.name}</strong></td>
                        <td>${candidate.email}</td>
                        <td>${candidate.phone || 'N/A'}</td>
                        <td>${candidate.applied_position}</td>
                        <td><span class="badge badge-${candidate.status}">${candidate.status.toUpperCase()}</span></td>
                        <td>
                            <div class="actions">
                                <select class="btn-small" onchange="updateCandidateStatus(${candidate.id}, this.value)">
                                    <option value="">Change Status</option>
                                    <option value="new">New</option>
                                    <option value="interview">Interview</option>
                                    <option value="hired">Hired</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading candidates:', error);
                document.getElementById('candidatesTable').innerHTML = '<tr><td colspan="6" class="loading">Error loading candidates</td></tr>';
            }
        }

        async function submitJob() {
            const jobTitle = document.getElementById('jobTitle').value;
            const department = document.getElementById('department').value;
            const experience = document.getElementById('experience').value;
            const salaryRange = document.getElementById('salaryRange').value;

            if (!jobTitle || !department) {
                alert('Please fill all fields');
                return;
            }

            try {
                const response = await fetch('http://13.60.237.35:3048/api/jobs', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ job_title: jobTitle, department, experience, salary_range: salaryRange })
                });

                if (response.ok) {
                    alert('Job posted successfully!');
                    toggleJobForm();
                    document.getElementById('jobTitle').value = '';
                    document.getElementById('department').value = '';
                    document.getElementById('experience').value = '';
                    document.getElementById('salaryRange').value = '';
                    loadJobs();
                }
            } catch (error) {
                console.error('Error posting job:', error);
                alert('Error posting job');
            }
        }

        async function closeJob(jobId) {
            try {
                await fetch(`http://13.60.237.35:3048/api/jobs/${jobId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ status: 'closed' })
                });
                loadJobs();
            } catch (error) {
                console.error('Error closing job:', error);
            }
        }

        async function updateCandidateStatus(candidateId, status) {
            if (!status) return;
            
            try {
                await fetch(`http://13.60.237.35:3048/api/candidates/${candidateId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ status })
                });
                loadCandidates();
            } catch (error) {
                console.error('Error updating candidate:', error);
            }
        }

        // Load initial data
        window.addEventListener('load', () => {
            loadJobs();
        });
    </script>
</body>
</html>
