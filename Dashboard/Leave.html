<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leave Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: #f8f9fa; padding: 30px; }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { font-size: 28px; color: #333; margin-bottom: 30px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .btn { background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        .btn:hover { background: #764ba2; }
        .form-container { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px; display: none; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        th { background: #667eea; color: white; padding: 15px; text-align: left; font-weight: 600; }
        td { padding: 15px; border-bottom: 1px solid #eee; }
        tr:hover { background: #f8f9fa; }
        .badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .badge-pending { background: #fff3cd; color: #856404; }
        .badge-approved { background: #d4edda; color: #155724; }
        .badge-rejected { background: #f8d7da; color: #721c24; }
        .action-btns { display: flex; gap: 10px; }
        .btn-small { padding: 6px 12px; font-size: 12px; background: #e9ecef; color: #333; border: none; border-radius: 4px; cursor: pointer; }
        .btn-small:hover { background: #667eea; color: white; }
        .loading { text-align: center; padding: 40px; color: #999; }
        .tabs { display: flex; gap: 20px; margin-bottom: 30px; border-bottom: 2px solid #eee; }
        .tab-btn { background: none; border: none; padding: 15px 0; font-size: 16px; cursor: pointer; color: #999; border-bottom: 3px solid transparent; font-weight: 600; }
        .tab-btn.active { color: #667eea; border-bottom-color: #667eea; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå¥ Leave Management</h1>
            <button class="btn" onclick="toggleApplyForm()">+ Apply Leave</button>
        </div>

        <!-- Apply Leave Form -->
        <div id="applyForm" class="form-container">
            <h3>Apply for Leave</h3>
            <div class="form-group">
                <label>Leave Type</label>
                <select id="leaveType">
                    <option value="Sick Leave">Sick Leave</option>
                    <option value="Casual Leave">Casual Leave</option>
                    <option value="Paid Leave">Paid Leave</option>
                    <option value="Unpaid Leave">Unpaid Leave</option>
                </select>
            </div>
            <div class="form-group">
                <label>From Date</label>
                <input type="date" id="fromDate">
            </div>
            <div class="form-group">
                <label>To Date</label>
                <input type="date" id="toDate">
            </div>
            <div class="form-group">
                <label>Reason</label>
                <textarea id="reason" rows="4" placeholder="Enter reason for leave"></textarea>
            </div>
            <button class="btn" onclick="submitLeaveRequest()">Submit Request</button>
            <button class="btn-small" onclick="toggleApplyForm()" style="background: #ccc; margin-left: 10px;">Cancel</button>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('myLeaves')">My Leaves</button>
            <button class="tab-btn" onclick="switchTab('pending')">Pending Approvals</button>
        </div>

        <!-- My Leaves Tab -->
        <div id="myLeaves" class="tab-content active">
            <table>
                <thead>
                    <tr>
                        <th>Leave Type</th>
                        <th>From Date</th>
                        <th>To Date</th>
                        <th>Reason</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="myLeavesTable">
                    <tr><td colspan="5" class="loading">Loading leaves...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Pending Tab -->
        <div id="pending" class="tab-content">
            <table>
                <thead>
                    <tr>
                        <th>Employee</th>
                        <th>Leave Type</th>
                        <th>From Date</th>
                        <th>To Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="pendingTable">
                    <tr><td colspan="6" class="loading">Loading pending requests...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'myLeaves') loadMyLeaves();
            if (tabName === 'pending') loadPendingLeaves();
        }

        function toggleApplyForm() {
            const form = document.getElementById('applyForm');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }

        async function loadMyLeaves() {
            try {
                const response = await fetch('http://16.16.68.191:3048/api/leave/my', { credentials: 'include' });
                const leaves = await response.json();
                
                if (leaves.length === 0) {
                    document.getElementById('myLeavesTable').innerHTML = '<tr><td colspan="5" class="loading">No leave requests</td></tr>';
                    return;
                }

                document.getElementById('myLeavesTable').innerHTML = leaves.map(leave => `
                    <tr>
                        <td><strong>${leave.leave_type}</strong></td>
                        <td>${leave.from_date}</td>
                        <td>${leave.to_date}</td>
                        <td>${leave.reason}</td>
                        <td><span class="badge badge-${leave.status}">${leave.status.toUpperCase()}</span></td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading leaves:', error);
                document.getElementById('myLeavesTable').innerHTML = '<tr><td colspan="5" class="loading">Error loading leaves</td></tr>';
            }
        }

        async function loadPendingLeaves() {
            try {
                const response = await fetch('http://16.16.68.191:3048/api/leave/pending', { credentials: 'include' });
                const leaves = await response.json();
                
                if (leaves.length === 0) {
                    document.getElementById('pendingTable').innerHTML = '<tr><td colspan="6" class="loading">No pending requests</td></tr>';
                    return;
                }

                document.getElementById('pendingTable').innerHTML = leaves.map(leave => `
                    <tr>
                        <td><strong>${leave.name}</strong></td>
                        <td>${leave.leave_type}</td>
                        <td>${leave.from_date}</td>
                        <td>${leave.to_date}</td>
                        <td><span class="badge badge-pending">PENDING</span></td>
                        <td>
                            <div class="action-btns">
                                <button class="btn-small" onclick="approveLeave(${leave.id})">Approve</button>
                                <button class="btn-small" onclick="rejectLeave(${leave.id})">Reject</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading pending leaves:', error);
                document.getElementById('pendingTable').innerHTML = '<tr><td colspan="6" class="loading">Error loading requests</td></tr>';
            }
        }

        async function submitLeaveRequest() {
            const leaveType = document.getElementById('leaveType').value;
            const fromDate = document.getElementById('fromDate').value;
            const toDate = document.getElementById('toDate').value;
            const reason = document.getElementById('reason').value;

            if (!leaveType || !fromDate || !toDate) {
                alert('Please fill all fields');
                return;
            }

            try {
                const response = await fetch('http://16.16.68.191:3048/api/leave/apply', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ employee_id: 1, leave_type: leaveType, from_date: fromDate, to_date: toDate, reason })
                });

                if (response.ok) {
                    alert('Leave request submitted!');
                    toggleApplyForm();
                    loadMyLeaves();
                }
            } catch (error) {
                console.error('Error submitting leave:', error);
                alert('Error submitting request');
            }
        }

        async function approveLeave(leaveId) {
            try {
                await fetch(`http://16.16.68.191:3048/api/leave/approve/${leaveId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ status: 'approved' })
                });
                loadPendingLeaves();
            } catch (error) {
                console.error('Error approving leave:', error);
            }
        }

        async function rejectLeave(leaveId) {
            try {
                await fetch(`http://16.16.68.191:3048/api/leave/approve/${leaveId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ status: 'rejected' })
                });
                loadPendingLeaves();
            } catch (error) {
                console.error('Error rejecting leave:', error);
            }
        }

        window.addEventListener('load', () => {
            loadMyLeaves();
        });
    </script>
</body>
</html>
            margin: 5px 0 0 0;
            color: #333;
        }
        .status-approved {
            background: #c8e6c9;
            color: #2e7d32;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .status-pending {
            background: #fff3e0;
            color: #f57f17;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèñÔ∏è Leave Management</h1>
        <p>Manage employee leave requests and approvals.</p>
        
        <div class="leave-request">
            <h3>John Doe - Vacation Leave</h3>
            <div class="leave-details">
                <div class="leave-info">
                    <label>From:</label>
                    <p>January 25, 2026</p>
                </div>
                <div class="leave-info">
                    <label>To:</label>
                    <p>January 29, 2026</p>
                </div>
                <div class="leave-info">
                    <label>Days:</label>
                    <p>5 days</p>
                </div>
                <div class="status-approved">‚úì Approved</div>
            </div>
        </div>
        
        <div class="leave-request">
            <h3>Jane Smith - Sick Leave</h3>
            <div class="leave-details">
                <div class="leave-info">
                    <label>From:</label>
                    <p>January 23, 2026</p>
                </div>
                <div class="leave-info">
                    <label>To:</label>
                    <p>January 24, 2026</p>
                </div>
                <div class="leave-info">
                    <label>Days:</label>
                    <p>2 days</p>
                </div>
                <div class="status-pending">‚è≥ Pending</div>
            </div>
        </div>
        
        <div class="leave-request">
            <h3>Mike Johnson - Casual Leave</h3>
            <div class="leave-details">
                <div class="leave-info">
                    <label>From:</label>
                    <p>February 5, 2026</p>
                </div>
                <div class="leave-info">
                    <label>To:</label>
                    <p>February 5, 2026</p>
                </div>
                <div class="leave-info">
                    <label>Days:</label>
                    <p>1 day</p>
                </div>
                <div class="status-approved">‚úì Approved</div>
            </div>
        </div>
    </div>
</body>
</html>
